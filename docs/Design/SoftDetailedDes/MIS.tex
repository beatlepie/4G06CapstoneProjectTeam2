\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}
\input{../../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
Jan 15 & 1.0 & Add introduction and module decomposition\\
Date 2 & 1.1 & Notes\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation at \href{https://github.com/beatlepie/4G06CapstoneProjectTeam2/blob/main/docs/SRS-Volere/SRS.pdf}{SRS}

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for CampusConnections. CampusConnections is a social media application with impressive AR camera and real time location map features that allows McMaster University students and visitors have an immersive user experience and expand their social networking. This application allows users to make new friends online and also encourage users to strengthen the friendship by in-person meet-ups with a on-campus location-sharing feature. It also provides heat maps of events and users, which allows students to join the most popular activities on campus. Besides, the application maintainers will share up-to-date events and lectures information for the community. The MIS will detail specifications for the project described above.

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found at \url{https://github.com/beatlepie/4G06CapstoneProjectTeam2/blob/main/docs/SRS-Volere/SRS.pdf} and \url{https://github.com/beatlepie/4G06CapstoneProjectTeam2/blob/main/docs/Design/SoftArchitecture/MG.pdf}

\section{Notation}

\wss{You should describe your notation.  You can use what is below as
  a starting point.}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of \progname \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, \progname \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding} & ~ \\
\midrule

\multirow{7}{0.3\textwidth}{Behaviour-Hiding}
& AR Interface\\
& User Module\\
& Lecture Module\\
& Event Module\\
& User Profile Module\\
& Friend Manager Module\\ 
& Friend Request Module\\ 
& Lecture Detail View Module\\
& Event Detail View Module\\
& Lecture List Manager Module\\
& Event List Manager Module\\
& Notification Module\\
\midrule

\multirow{3}{0.3\textwidth}{Software Decision}
& Database Module\\
& Server Module\\
& Authentication Module\\
& AR Camera Module\\
& Map Module\\
& Activity Detail View Module\\
& Pagination and Filter Module\\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

\newpage

\section{MIS of Friend Manager Module} \label{mFM}

\subsection{Module}

FriendManager

\subsection{Uses}

User Module, Database Module, Authentication Module, Server Module

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}
\begin{center}
\begin{tabular}{p{4cm} p{2cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GetUser & - & - & - \\
GetFriendList & - & - & - \\
DisplayFriendList & - & -\\
DeleteFriend & String & - & IndexOutofBound Exception \\
ViewFriend & String & - & IndexOutofBound Exception\\
MessageFriend & String & - & IndexOutofBound Exception, ServerConnection Exception\\
SendRequest & String & String & -\\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
\item currentUser: FirebaseUser
\item friends: set of User
\item friendsContainer: set of Transform
\end{itemize}

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

Assume friends are updated in the database immediately after the request is sent.

\subsubsection{Access Routine Semantics}

\noindent GetUser():
\begin{itemize}
\item transition: $currentUser := Authentication.CurrentUser$
\item output: none
\item exception: none
\end{itemize}

\noindent GetFriendList():
\begin{itemize}
\item transition: $friends := GetFriendsFromDB(currentUser)$ 
\item output: none
\item exception: none
\end{itemize}

\noindent DisplayFriendList():
\begin{itemize}
\item transition: $(\forall x : \mathbb{Z} | 0 \leq x \leq friends.length:\\ friendsContainer[i].position, friendsContainer[i].content = (0, i*HEIGHT), friends[i])$, then display a list using friendsContainer
\item output: none
\item exception: none
\end{itemize}

\noindent DeleteFriend(targetEmail):
\begin{itemize}
\item transition: $friends :=$ friends - \{targetEmail\}
\item output: none
\item exception: $exc := targetEmail \notin friends \Rightarrow IndexOutofBound Exception$
\end{itemize}

\noindent ViewFriend(targetEmail):
\begin{itemize}
\item transition: Switch scene to user profile of the target user
\item output: none
\item exception: $exc := targetEmail \notin friends \Rightarrow IndexOutofBound Exception$
\end{itemize}

\noindent MessageFriend(targetEmail):
\begin{itemize}
\item transition: Display Chat UI between $currentUser$ and $targetEmail$
\item output: none
\item exception: $exc := targetEmail \notin friends \Rightarrow IndexOutofBound Exception$
\end{itemize}

\noindent SendRequest(targetEmail):
\begin{itemize}
\item transition: $targetEmail \notin friends \Rightarrow$ Add request in target user request list in the database
\item output: $targetEmail \notin friends$
\item exception: none
\end{itemize}

\subsubsection{Local Functions}

\noindent GetFriendsFromDB(email): Seq of User\\
It gets all friends under the input user email and convert them to an array of User
\begin{itemize}
\item transition: none
\item output: $out := Database.GetValueAsync(ROOT + email + FRIENDPATH).ToArray()$
\item exception: none
\end{itemize}

\subsubsection{Local Constants}
HEIGHT = 300 px\\
ROOT = Database root path\\
FRIENDPATH = path string for user friends list

\newpage

\section{MIS of Friend Request Module} \label{mFR}

\subsection{Module}

FriendRequest

\subsection{Uses}

User Module, Database Module, Authentication Module,

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}
\begin{center}
\begin{tabular}{p{4cm} p{2cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
GetUser & - & - & - \\
GetRequestList & - & - & - \\
DisplayRequestList & - & -\\
AcceptRequest & String & - & IllegalArgument Exception \\
IgnoreRequest & String & - & IllegalArgument Exception\\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
\item currentUser: FirebaseUser
\item requests: set of User
\item requestsContainer: set of Transform
\item requestNum: $\mathbb{Z}$
\end{itemize}

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

Assume friend requests are updated in the database immediately after the request is sent.

\subsubsection{Access Routine Semantics}

\noindent GetUser():
\begin{itemize}
\item transition: $currentUser := Authentication.CurrentUser$
\item output: none
\item exception: none
\end{itemize}

\noindent GetRequestList():
\begin{itemize}
\item transition: $friends := GetRequestsFromDB(currentUser)$ 
\item output: none
\item exception: none
\end{itemize}

\noindent DisplayRequestList():
\begin{itemize}
\item transition: $(\forall x : \mathbb{Z} | 0 \leq x \leq requests.length:\\ requestsContainer[i].position, requestsContainer[i].content = (0, i*HEIGHT), requests[i])$, then display a list using requestsContainer
\item output: none
\item exception: none
\end{itemize}

\noindent AcceptRequest(targetEmail):
\begin{itemize}
\item transition: targetEmail is added in currentUser friend list and currentEmail is added in targetEmail friend list in the database\\$request := request - \{targetEmail\}$
\item output: none
\item exception: $exc := Database.HasChild(ROOT + targetEmail) = \text{null} \Rightarrow\\ IllegalArgument Exception$
\end{itemize}

\noindent IgnoreRequest(targetEmail):
\begin{itemize}
\item transition: $request := request - \{targetEmail\}$
\item output: none
\item exception: $exc := Database.HasChild(ROOT + targetEmail) = \text{null} \Rightarrow\\ IllegalArgument Exception$
\end{itemize}

\subsubsection{Local Functions}

\noindent UpdateBadge(): String\\
It returns the content of friend request badge given the request number
\begin{itemize}
\item transition: none
\item output: $out := requestNum = 0 \Rightarrow empty string \\ 0 < requestNum < 100 \Rightarrow requestNum\\ 100 \leq requestNum \Rightarrow 99+$
\item exception: none
\end{itemize}

\noindent GetRequestsFromDB(email): Seq of User\\
It gets all friend requesters under the input user email and convert them to an array of User
\begin{itemize}
\item transition: none
\item output: $out := Database.GetValueAsync(ROOT + email + REQUESTPATH).ToArray()$
\item exception: none
\end{itemize}

\subsubsection{Local Constants}
HEIGHT = 150 px\\
ROOT = Database root path\\
REQUESTPATH = path string for user friend requests list

\newpage

\section{MIS of Activity Detail View Module} \label{mADV}

\subsection{Module}

ActivityDetailViewModule

\subsection{Uses}

Database Module, Authentication Module

\subsection{Syntax}

\subsubsection{Exported Constants}

None

\subsubsection{Exported Access Programs}
\begin{center}
\begin{tabular}{p{4cm} p{2cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
ViewActivities & - & - & - \\
AddActivity & Activity & - & - \\
EditActivity & Activity & - & IndexOutofBound Exception \\
DeleteActivity & Activity & - & IndexOutofBound Exception \\
PinActivity & Activity & - & IndexOutofBound Exception \\
UnpinActivity & Activity & - & IndexOutofBound Exception \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
  \item activities: set of Activity
\end{itemize}

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

\subsubsection{Access Routine Semantics}

ViewActivities():
\begin{itemize}
  \item transition: Display user's activities
  \item output: none
  \item exception: none
  \end{itemize}

AddActivity(targetActivity):
\begin{itemize}
  \item transition:
  \item output: none
  \item exception:
  \end{itemize}

EditActivity(targetActivity):
\begin{itemize}
  \item transition:
  \item output: none
  \item exception:
  \end{itemize}

DeleteActivity(targetActivity):
\begin{itemize}
  \item transition: $activities := activities - \{targetActivity\}$
  \item output: none
  \item exception: $exc := targetActivity \notin activities \Rightarrow IndexOutofBound Exception$
  \end{itemize}

PinActivity(targetActivity):
\begin{itemize}
  \item transition:
  \item output: none
  \item exception:
  \end{itemize}

UnpinActivity(targetActivity):
\begin{itemize}
  \item transition:
  \item output: none
  \item exception:
  \end{itemize}

\subsubsection{Local Functions}

None

\subsubsection{Local Constants}

ROOT = Database root path

\newpage

\section{MIS of Notification Module} \label{mNotify}

\subsection{Module}

Notification

\subsection{Uses}

\subsection{Syntax}

\subsubsection{Exported Constants}
None

\subsubsection{Exported Access Programs}
\begin{center}
\begin{tabular}{p{4cm} p{2cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
Consent & - & String & - \\
MapWarning & - & String & - \\
DataCollectionWarning & - & -\\
NoInternetNotification & - & String & -\\
ARCameraNotification & - & String & -\\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

None

\subsubsection{Assumptions}

None

\subsubsection{Access Routine Semantics}

\noindent Consent():
\begin{itemize}
\item transition: none
\item output: $out := USERCONSENT$
\item exception: none
\end{itemize}

\noindent MapWarning():
\begin{itemize}
\item transition: none
\item output: $out := MAP$
\item exception: none
\end{itemize}

\noindent DataCollectionWarning():
\begin{itemize}
\item transition: none
\item output: $out := DATACOLLECTION$
\item exception: none
\end{itemize}

\noindent NoInternetNotification():
\begin{itemize}
\item transition: none
\item output: $out := NOINTERNET$
\item exception: none
\end{itemize}

\noindent ARCameraNotification():
\begin{itemize}
\item transition: none
\item output: $out := ARCAMERA$
\item exception: none
\end{itemize}

\subsubsection{Local Functions}

None

\subsubsection{Local Constants}
USERCONSENT = Text of user consent when creating account\\
MAP = Text of warning message show when start the map\\
DATACOLLECTION = Text of warning before the application collects user data\\
NOINTERNET = Notification message when the internet is lost\\
ARCAMERA =  Help message for AR camera functionality\\

\newpage

\section{MIS of Database Module} \label{mDB}

\subsection{Module}

FirebaseDatabase

\noindent This module uses Firebase Realtime Database library. For details of all syntax and semantics of exported constants and access programs, see \href{https://firebase.google.com/docs/reference/unity/namespace/firebase/database}{Firebase database documentation}.
documentation
\subsection{Uses}

\subsection{Syntax}

\subsubsection{Exported Constants}
See \href{https://firebase.google.com/docs/reference/unity/namespace/firebase/database}{Firebase database documentation}.
\subsubsection{Exported Access Programs}
The following table will show some functions the application uses most frequently, for more details, see \href{https://firebase.google.com/docs/reference/unity/namespace/firebase/database}{Firebase database documentation}.
\begin{center}
\begin{tabular}{p{4cm} p{2cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
Child & String & DatabaseReference & PermissionDenied, NetworkError, ExpiredToken \\
HasChild & String & $\mathbb{B}$ & PermissionDenied, NetworkError, ExpiredToken \\
RemoveValueAsync & String & Task$<\mathbb{B}>$ & PermissionDenied,  NetworkError,  ExpiredToken \\
SetValueAsync & String , String & Task$<\mathbb{B}>$ & PermissionDenied,  NetworkError,  ExpiredToken \\
GetValueAsync & String & Task$<$DataSnapshot$>$ & PermissionDenied, NetworkError,  ExpiredToken \\
GoOffline & - & - & PermissionDenied, NetworkError,  ExpiredToken \\
GoOnline & - & - & PermissionDenied, NetworkError,  ExpiredToken \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

None

\subsubsection{Environment Variables}

\begin{itemize}
\item DBreference: Firebase.Database.DatabaseReference\\
A reference to the root location of this database
\item User: Firebase.Auth.FirebaseUser\\
The current user that operates this database
\item PermittedUsers: set of String\\
The list of user emails that are allowed to read the database content
\item Admins: set of String\\
The list of user emails that are allowed to edit the database content
\end{itemize}


\subsubsection{Assumptions}

Assume the database connection is stable and it will not disconnect unless the user disconnect it manually.

\subsubsection{Access Routine Semantics}

\noindent Child(pathString):
\begin{itemize}
\item transition: none 
\item output: $out :=$ DatabaseReference to pathString relative to the root
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin PermittedUsers \Rightarrow PermissionDenied$
\end{itemize}

\noindent HasChild(pathString):
\begin{itemize}
\item transition: none 
\item output: $out := DBreference.Child(pathString) = \text{null}$
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin PermittedUsers \Rightarrow PermissionDenied$
\end{itemize}

\noindent RemoveValueAsync(pathString):
\begin{itemize}
\item transition: $DBreference.Child(pathString) := \text{null}$
\item output: $out := DBreference.HasChild(pathString)$
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin Admins \Rightarrow PermissionDenied$
\end{itemize}

\noindent SetValueAsync(pathString, value):
\begin{itemize}
\item transition: $DBreference.Child(pathString) := value$
\item output: $out := DBreference.Child(pathString) = value$
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin Admins \Rightarrow PermissionDenied$
\end{itemize}

\noindent GetValueAsync(pathString):
\begin{itemize}
\item transition: none
\item output: $out :=$ Snapshot of $DBreference.Child(pathString)$
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin PermittedUsers \Rightarrow PermissionDenied$
\end{itemize}

\noindent GoOffline():
\begin{itemize}
\item transition: Manually disconnect the FirebaseDatabase client from the server and disable automatic reconnection.
\item output: none
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin Admins \Rightarrow PermissionDenied$
\end{itemize}

\noindent GoOnline():
\begin{itemize}
\item transition: Manually reestablish a connection to the FirebaseDatabase server and enable automatic reconnection.
\item output: none
\item exception: $exc := NoInternet \Rightarrow NetworkError\ | \ TokenExpired \Rightarrow ExpiredToken\ | \\ User.email \notin Admins \Rightarrow PermissionDenied$
\end{itemize}

\subsubsection{Local Functions}

None

\newpage

\bibliographystyle {plainnat}
\bibliography {../../../refs/References}

\newpage

\section{Appendix} \label{Appendix}

\wss{Extra information if required}

\end{document}